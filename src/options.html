<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Container Traffic Control Options</title>
    <link rel="stylesheet" href="options.css">
</head>
<body>
    <div class="container">
        <h1>Container Traffic Control</h1>
        <p>
            Define rules for each container to control which websites are allowed to open in it.
            See help section below for more information.
        </p>

        <div class="preferences-section">
            <label for="debugLoggingCheckbox" class="debug-toggle">
                <input type="checkbox" id="debugLoggingCheckbox">
                Enable debug logging (verbose console output)
            </label>
        </div>

        <div class="rules-section">
            <div class="validation-messages" id="validationMessages"></div>

            <div class="button-group">
                <button id="saveRulesTopBtn" class="btn btn-primary">Save Rules</button>
            </div>

            <table id="rulesTable" class="rules-table">
                <tbody id="rulesTableBody">
                </tbody>
            </table>

            <div class="button-group">
                <button id="saveRulesBottomBtn" class="btn btn-primary">Save Rules</button>
            </div>
        </div>

        <div class="help-section">
            <h2>Tips</h2>
            <p>We start out by listing all the containers you have created. Then you can apply rules to each container.</p>

            <h4>Start by picking Container Type to activate</h4>
            <div class="rule-legend">
                <p><strong>üåê Open</strong> Use for containers that should handle specific sites (i.e. sites will pick these containers to open in) but also remain open for general browsing.</p>
                <p><strong>üîí Restricted</strong>Use for strict isolation. Container will *only* accept the specified URLs. Navigating to non-matching URLs will boot you out of this container. It will try to find a matching container to open in otherwise open in "no container".</p>
            </div>

            <h4>URL Pattern</h4>
            <div class="rule-legend">
                <p><strong>Simple patterns:</strong> Just enter the domain or URL as you see it.</p>
                <ul>
                    <li>More often than not, this is the best option. </li>
                    <li><span style="color: blue;"><code>github.com</code></span></span> matches any URL containing "github.com"</li>
                    <li><span style="color: blue;"><code>mail.google.com</code></span></span> matches Gmail URLs</li>
                    <li><span style="color: blue;"><code>work.example.com</code></span></span> matches work site URLs</li>
                </ul>
                <p><strong>Regex patterns:</strong> Wrap in slashes for advanced regex matching</p>
                <ul>
                    <li><strong>/</strong><span style="color: blue;"><code>github\.com</code></span><strong>/</strong> finds github.com anywhere in the URL</li>
                    <li><strong>/</strong><span style="color: blue;"><code>.*github\.com</code></span><strong>/</strong> similar to above finds github.com anywhere in the URL</li>
                    <li><strong>/</strong><span style="color: blue;"><code>^github\.com/</code></span><strong>/</strong> won't match since URLs start with "https://" github.com/user/repo</li>
                    <li><strong>/</strong><span style="color: blue;"><code>.*\.github\.com</code></span><strong>/</strong> matches api.github.com but won't match https://github.com/user/repo</li>
                    <li><strong>/</strong><span style="color: blue;"><code>.*\.?github\.com</code></span><strong>/</strong> matches api.github.com & github.com/user (but just use `/github\.com/` for simpler matching)</li>
                </ul>
            </div>

            <h4>High Priority Checkbox</h4>
            <div class="rule-legend">
                <p>When multiple containers match a URL (and you're about to move to a new container), high-priority rules are chosen first.</p>
                <p><strong>Example:</strong> Both "Personal" and "Work" containers match <code>github.com</code> but "Work" has high priority checkbox checked, CTC will pick it to open the URL.</p>
                <p>This is particularly useful for cases like docs.google.com where you might want to open google docs in both a personal and work container, so you have it in both. But when starting from a new tab, you might prefer to open it in the personal container.</p>
            </div>

            <h3>How Container Traffic Control Works</h3>
            <ol>
                <li><strong>Stay Put:</strong> If your current container accepts the URL, you stay there</li>
                <li><strong>Restricted Containers:</strong> If you're in a container with "Allow Only" rules and click a non-matching link, you'll be moved out</li>
                <li><strong>Finding a Match:</strong> When switching containers, high-priority rules win first</li>
                <li><strong>Default:</strong> If no rules match, opens in "No Container" (regular browsing)</li>
            </ol>
        </div>

        <div class="import-export-section">
            <h2>Import / Export Rules</h2>

            <div class="export-section">
                <label for="exportOutput">Export:</label>
                <button id="exportBtn" class="btn btn-primary">Export</button>
                <input type="text" id="exportOutput" class="export-output" readonly style="display:none;">
            </div>

            <div class="import-section">
                <label for="importJsonInput">Import JSON:</label>
                <input type="text" id="importJsonInput" class="import-input" placeholder="Paste JSON rules here">
                <button id="importBtn" class="btn btn-primary">Import</button>
            </div>
        </div>
    </div>

    <!-- Template definitions for dynamic content -->
    <template id="container-group-template">
        <tr class="container-group-wrapper">
            <td colspan="5">
                <div class="container-group" data-container-name="">
                    <div class="container-header-row">
                        <select class="container-type-select">
                            <option value="no-rule">No Rule</option>
                            <option value="open">üåê Open</option>
                            <option value="restricted">üîí Restricted</option>
                        </select>
                        <span class="container-name"></span>
                        <button type="button" class="btn btn-secondary btn-small add-url-btn" title="Add URL pattern">+</button>
                        <button type="button" class="btn btn-danger btn-small clear-btn" title="Remove all URL patterns from this container">Clear</button>
                    </div>
                </div>
            </td>
        </tr>
    </template>

    <template id="url-pattern-row-template">
        <div class="url-pattern-row">
            <input type="text" class="url-pattern-input" placeholder="regulardomain.com or /regex pattern/" required>
            <input type="checkbox" class="priority-checkbox">
            <button type="button" class="btn btn-danger btn-small delete-btn">Delete</button>
        </div>
    </template>

    <script src="logging.js"></script>
    <script src="pattern-matching.js"></script>
    <script src="storage-compression.js"></script>
    <script src="ctc-repository.js"></script>
    <script src="options.js"></script>
</body>
</html>
