<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Container Traffic Control Options</title>
    <link rel="stylesheet" href="options.css">
</head>
<body>
    <div class="container">
        <h1>Container Traffic Control</h1>
        <p>
            Define rules for each container to control which websites are allowed to open in it.
            See help section below for more information.
        </p>

        <div class="rules-section">
            <div class="validation-messages" id="validationMessages"></div>

            <div class="button-group">
                <button id="saveRulesTopBtn" class="btn btn-primary">Save Rules</button>
            </div>

            <table id="rulesTable" class="rules-table">
                <tbody id="rulesTableBody">
                </tbody>
            </table>

            <div class="button-group">
                <button id="saveRulesBottomBtn" class="btn btn-primary">Save Rules</button>
            </div>
        </div>

        <div class="help-section">
            <h2>Tips</h2>
            <p>We start out by listing all the containers you have created. Then you can apply rules to each container.</p>

            <h4>Start by picking Container Type to activate</h4>
            <div class="rule-legend">
                <p><strong>üåê Open</strong> Use for containers that should handle specific sites (i.e. sites will pick these containers to open in) but also remain open for general browsing.</p>
                <p><strong>üîí Restricted</strong>Use for strict isolation. Container will *only* accept the specified URLs. Navigating to non-matching URLs will boot you out of this container. It will try to find a matching container to open in otherwise open in "no container".</p>
            </div>

            <h4>Container</h4>
            <div class="rule-legend">
                <p>firefox container the rule applies to. "no container" means default browsing without container isolation.</p>
                <p>See <a href="https://addons.mozilla.org/en-US/firefox/addon/multi-account-containers/" target="_blank">Multi-Account Containers</a> for creating and managing containers.</p>
            </div>

            <h4>URL Pattern</h4>
            <div class="rule-legend">
                <p><strong>Simple patterns:</strong> Type the domain or URL part directly</p>
                <ul>
                    <li><code>github.com</code> ‚Üí matches any URL containing "github.com"</li>
                    <li><code>mail.google.com</code> ‚Üí matches Gmail URLs</li>
                    <li><code>work.example.com</code> ‚Üí matches work site URLs</li>
                </ul>
                <p><strong>Regex patterns:</strong> Wrap in slashes for advanced matching</p>
                <ul>
                    <li><code>/.*\.google\.com/</code> ‚Üí matches any Google subdomain</li>
                    <li><code>/^https://github\.com/user/</code> ‚Üí matches specific user's repos</li>
                    <li><code>/\.(work|company)\.com$/</code> ‚Üí matches multiple work domains</li>
                </ul>
            </div>

            <h4>High Priority</h4>
            <div class="rule-legend">
                <p>When multiple containers match a URL (and you're about to move to a new container), high-priority rules are chosen first. Use to override default container assignments.</p>
                <p><strong>Example:</strong> Both "Personal" and "Work" containers match <code>github.com</code>, but "Work" has high priority ‚Üí opens in Work container.</p>
            </div>

            <h3>How Container Traffic Control Works</h3>
            <ol>
                <li><strong>Stay Put:</strong> If your current container accepts the URL, you stay there</li>
                <li><strong>Restricted Containers:</strong> If you're in a container with "Allow Only" rules and click a non-matching link, you'll be moved out</li>
                <li><strong>Finding a Match:</strong> When switching containers, high-priority rules win first</li>
                <li><strong>Default:</strong> If no rules match, opens in "No Container" (regular browsing)</li>
            </ol>
        </div>
    </div>

    <!-- Template definitions for dynamic content -->
    <template id="container-group-template">
        <tr class="container-group-wrapper">
            <td colspan="5">
                <div class="container-group" data-container-name="">
                    <div class="container-header-row">
                        <select class="container-type-select">
                            <option value="no-rule">No Rule</option>
                            <option value="open">üåê Open</option>
                            <option value="restricted">üîí Restricted</option>
                        </select>
                        <span class="container-name"></span>
                        <button type="button" class="btn btn-secondary btn-small add-url-btn" title="Add URL pattern">+</button>
                        <button type="button" class="btn btn-danger btn-small clear-btn" title="Remove all URL patterns from this container">Clear</button>
                    </div>
                </div>
            </td>
        </tr>
    </template>

    <template id="url-pattern-row-template">
        <div class="url-pattern-row">
            <input type="text" class="url-pattern-input" placeholder="regulardomain.com or /regex pattern/" required>
            <input type="checkbox" class="priority-checkbox">
            <button type="button" class="btn btn-danger btn-small delete-btn">Delete</button>
        </div>
    </template>

    <script src="utils.js"></script>
    <script src="ctc-repository.js"></script>
    <script src="options.js"></script>
</body>
</html>